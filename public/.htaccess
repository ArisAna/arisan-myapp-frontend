# ============================================
# Next.js Static Export - Apache Config
# ============================================

DirectoryIndex index.html
Options -Indexes
DirectorySlash Off

# -- Route handling: serve .html files for clean URLs --
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Serve actual files (JS, CSS, images, etc.) as-is
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]

  # Handle trailing slash: /lobby/ → serve lobby.html internally (no redirect)
  RewriteCond %{REQUEST_URI} ^/(.+)/$
  RewriteCond %{DOCUMENT_ROOT}/%1.html -f
  RewriteRule ^(.+)/$ %1.html [L,NC]

  # If filename.html exists, serve it
  # (no !-d check — handles case where a stale directory co-exists with the .html)
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}.html -f
  RewriteRule ^(.+)$ $1.html [L]
</IfModule>

# ============================================
# Cache Control
# ============================================
<IfModule mod_headers.c>

  # HTML pages: always revalidate
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "public, no-cache"
  </FilesMatch>

  # Hashed assets (_next/static): cache forever
  <FilesMatch "\.(js|css)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Fonts: cache for 1 year
  <FilesMatch "\.(woff|woff2|ttf|otf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Images: cache for 30 days
  <FilesMatch "\.(ico|png|jpg|jpeg|gif|svg|webp|avif)$">
    Header set Cache-Control "public, max-age=2592000"
  </FilesMatch>

</IfModule>

# ============================================
# Compression
# ============================================
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>
